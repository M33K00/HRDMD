<%- include('../../layouts/hrislayout') -%>
<style>
  .header {
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
    background-color: inherit;
    height: 200px;
  }
  
  .header .logo {
    position: absolute;
    left: 310;
    top: 35%;
    transform: translateY(-50%);
    width: 100px; /* Adjust the width as needed */
    height: auto; /* Maintain aspect ratio */
  }
  
  .text-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
  }
  
  
  .header h5 {
    margin: 0;
    font-size: 18px;
  }
  
  .header h3 {
    margin-top: 30px;
  }
  
  .footer p {
    margin: 0;
    font-size: 15px;
  }
  </style>
<body>
  <%- include('../../layouts/navhris') -%>
<div class="print-body fade-in">
  <div class="page-name">
    <h1>DTR Report</h1>
    <a href="/hrSettings" class="btn btn-secondary">GO BACK</a>
  </div>
  <div class="printBTNS">
    <button id="download" class="btn btn-primary">Download as PDF</button>
    <button id="closeDTR" class="btn btn-danger closeBTN mb-2" data-toggle="modal" data-target="#confirmModal">CLOSE REPORT</button>
  </div>
  <div class="rounded-box mt-3">
  <div class="page-content p-4 bg-white" id="page-content">
    <div class="header">
      <img src="https://i.imgur.com/7RbCGni.png" class="logo">
      <div class="text-container">
        <h5 class="text-center">Republic of the Philippines</h5>
        <h5 class="text-center">City Government of Bacoor</h5>
        <h5 class="text-center">Bacoor Government Center, Brgy. Bayanan,</h5>
        <h5 class="text-center">Bacoor Blvd., City of Bacoor, Cavite</h5>
        <h3 class="text-center">DAILY TIME RECORD REPORT</h3>
      </div>
    </div>  
    <% if (employeeData.length > 1) { %>
      <h3>DTR Record for the Month of <strong class="text-uppercase"><%- monthName %> <%- currentYear %></strong></h3>
      <table id="table" class="table table-hover table-striped table-bordered">
        <thead>
          <tr class="table-dark text-center text-uppercase">
            <th>Employee Name</th>
            <th>Days Present</th>
            <th>Days Absent</th>
            <th>Total Hours Worked</th>
          </tr>
        </thead>
        <tbody>
          <% employeeData.forEach((attendance) => { -%>
          <tr>
            <td><%- attendance.name %></td>
            <td><%- attendance.presentDays %></td>
            <td><%- attendance.absentDays %></td>
            <td><%- attendance.totalTime.toFixed(2) %></td>
          </tr>
          <% }) -%>
        </tbody>
      </table>
    <% } else { %>
      <table id="table" class="table table-hover table-striped table-bordered">
        <thead>
          <tr class="table-dark text-center text-uppercase">
            <th>Employee Name</th>
            <th>Days Present</th>
            <th>Days Absent</th>
            <th>Days on Leave</th>
            <th>Total Hours Worked</th>
          </tr>
        </thead>
        <tbody>
          <% attendance.forEach((attendance) => { -%>
          <tr>
            <td><%- attendance.name %></td>
            <td><%- attendance.daysPresent %></td>
            <td><%- attendance.daysAbsent %></td>
            <td><%- attendance.daysOnLeave %></td>
            <td><%- attendance.hoursWorked.toFixed(2) %></td>
          </tr>
          <% }) -%>
        </tbody>
      </table>
    <% } %>
    <div class="footer">
      <p>Report generated on <%- new Date().toLocaleString() %></p>
      <p>Report generated by <%- user.name %> <%- user.lastname %></p>
    </div>
  </div>
</div>
</div>
<!-- Modal -->
<div class="modal fade" id="confirmModal" tabindex="-1" role="dialog" aria-labelledby="confirmModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="confirmModalLabel">Confirm Report Closure</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        Are you sure you want to close DTR for the department? <strong class="text-danger">This action cannot be undone.</strong>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-danger" id="confirmCloseDTR">Confirm</button>
      </div>
    </div>
  </div>
</div>
</body>
<script src="../../scripts/html2pdf.bundle.min.js"></script>
<script>
  document.getElementById("download").addEventListener("click", () => {
  // Select the content of the div
  var element = document.getElementById("page-content");

  // Configure the options for the PDF
  var opt = {
    filename: "DTRReport.pdf",
    image: { type: "jpeg", quality: 1.0 },
    html2canvas: {
      margin: 1,
      scale: 5.0,
      dpi: 144,
      letterRendering: true,
      useCORS: true // Use this option if you have cross-origin images
    },
    jsPDF: { unit: "in", format: "legal", orientation: "landscape" },
  };

  // Use html2pdf to create and download the PDF
  html2pdf().from(element).set(opt).save();
});

</script>
<script>
  document.getElementById('confirmCloseDTR').addEventListener('click', function() {
    const department = '<%= department %>'; // Make sure to use the correct server-side templating variable
    window.location.href = `/closeDTR/${department}`;
  });
</script>
<%- include('../../layouts/footer') %>
